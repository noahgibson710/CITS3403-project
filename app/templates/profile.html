{% extends "base.html" %}

{% block title %}Profile Page{% endblock %}

{% block content %}
<div class="profile-container">
    <header class="profile-header">
        <h1>Profile Page</h1>
    </header>

    <section class="profile-info">
        <img src="{{ url_for('static', filename='images/placeholder-profile.jpg') }}" alt="Profile Picture" class="profile-picture">
        <h2 id="username">Username: <strong>{{ user.name if user else '[Placeholder]' }}</strong></h2>
        <p id="email">Email: <strong>{{ user.email if user else '[Placeholder]' }}</strong></p>
    </section>
    

    <section class="graph">
        <h3>Macro History Graph</h3>
        <div id="macro-history-graph" style="width: 100%; height: 400px; margin-bottom: 20px;"></div>

    </section>

    
    
    <section class="macro-history">
        <h3>Macro History</h3>
        {% if macro_posts %}
            <ul>
                {% for post in macro_posts %}
                    <li>
                        <strong>Date:</strong> {{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}<br>
                        <strong>Weight:</strong> {{ post.weight }} kg<br>
                        <strong>BMR:</strong> {{ post.bmr }} cal/day,
                        <strong>TDEE:</strong> {{ post.tdee }} cal/day
                        <form action="{{ url_for('delete_macro_post', post_id=post.id) }}" method="POST" style="inline">
                            <button type="submit" onclick="return confirm('Are you sure you want to delete this entry?');">Delete</button>
                        </form>
                        <form action="{{ url_for('create_feed_post', post_id = post.id) }}" method="POST" style="inline">
                            {% if macro_posts %}
                                <input type="hidden" name="content" value="Latest Macro Stats - Weight: {{ macro_posts[-1].weight }}kg, BMR: {{ macro_posts[-1].bmr }}, TDEE: {{ macro_posts[-1].tdee }}">
                            {% else %}
                                <input type="hidden" name="content" value="No macro stats available.">
                            {% endif %}
                                    <button type="submit">Share to Community Feed</button>
                        </form>
                        
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>You haven't saved any results yet.</p>
        {% endif %}
    </section>
</div>

<div class="theme-toggle">
    <label class="theme-label" for="theme-switch">Toggle Theme</label>
    <label class="switch">
        <input type="checkbox" id="theme-switch" onchange="toggleTheme()" />
        <span class="slider"></span>
    </label>
</div>

{% endblock %}

{% block scripts %}
<script>
    const macroData = {
        dates: [{% for post in macro_posts[::-1] %}"{{ post.timestamp.strftime('%Y-%m-%d') }}"{% if not loop.last %}, {% endif %}{% endfor %}],
        weights: [{% for post in macro_posts[::-1] %}{{ post.weight }}{% if not loop.last %}, {% endif %}{% endfor %}],
        bmr: [{% for post in macro_posts[::-1] %}{{ post.bmr }}{% if not loop.last %}, {% endif %}{% endfor %}],
        tdee: [{% for post in macro_posts[::-1] %}{{ post.tdee }}{% if not loop.last %}, {% endif %}{% endfor %}]
    };
</script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script>
    Highcharts.chart('macro-history-graph', {
        chart: {
            type: 'line'
        },
        title: {
            text: 'Macro History'
        },
        xAxis: {
            categories: macroData.dates,
            title: { text: 'Date' }
        },
        yAxis: {
            title: {
                text: 'Values' 
            }
        },
        series: [
            {
                name: 'Weight (kg)',
                data: macroData.weights
            },
            {
                name: 'BMR (cal/day)',
                data: macroData.bmr
            },
            {
                name: 'TDEE (cal/day)',
                data: macroData.tdee
            }
        ]
    });
</script>

{% endblock %}
